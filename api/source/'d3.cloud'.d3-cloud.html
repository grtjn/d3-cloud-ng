<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <base href="../">
    <title>JSDoc: source : d3-cloud.directive.js</title>
    <link href="css/prettify-tomorrow.css" type="text/css" rel="stylesheet">
    <link href="css/site.css" type="text/css" rel="stylesheet">
  </head>
  <body ng-app="">
    <nav id="toc">
      <input placeholder="Filter" id="filter-input" class="col12 block field" type="text">
      <div class="nav-wrapper">
      <h2><a href="index.html">Index</a></h2>
      <ul class="module">
        <!-- _d__cloud_ -->
        <h2 class="module">
          <a chref="" ng-click="module_d__cloud_ = !module_d__cloud_">
            module: 'd3.cloud'
          </a>
          <i ng-cloak="" ng-show="module_d__cloud_">+</i>
        </h2>
        <li id="'d3.cloud'" ng-hide="module_d__cloud_">
          <ul class="group">
            <h2>
              <a href="" ng-click="_d__cloud_directive = !_d__cloud_directive">
                directive
              </a>
              <i ng-cloak="" ng-show="_d__cloud_directive">+</i>
            </h2>
            <ul ng-hide="_d__cloud_directive">
              <li>
                <a href="-_d3.cloud_.d3-cloud.html">d3-cloud</a>
              </li>
            </ul>
          </ul>
        </li>
      </ul>
      </div>
    </nav>
    <div id="content" class="page-wrap">
      <h1 class="title">
        source : d3-cloud.directive.js
      </h1>
      <div id="main" class="big-container">
        <!-- source code html -->
        <article>
          <pre class="prettyprint source linenums"><code> /**
  * @ngdoc directive
  * @memberOf 'd3.cloud'
  * @name d3-cloud
  * @description
  *   Angular directive wrapping the d3-cloud library.
  *
  * @attr {Object}    events        Optional. An object with a property for each event callback function to be supported. Default: {}.
  * @attr {String}    font          Optional. The name of the font to use. Default: Impact.
  * @attr {Array}     ignoreList    Optional. An array of word names to ignore. Default: [].
  * @attr {Integer}   padding       Optional. The padding to apply between words. Default: 5.
  * @attr {Function}  rotate        Optional. A function reference that calculates rotation per word. Takes word object, and index in 'words' array. Default: alternating 45 degree left/right.
  * @attr {Integer}   slope-base    Optional. The minimum size for words. Default: 2.
  * @attr {Integer}   slope-factor  Optional. The scale factor applied to scores. Default: 30.
  * @attr {Array}     words         A binding to an array of objects with name and score properties.
  *
  * @example
  *   &lt;d3-cloud events="ctrl.wordEvents" font="Impact" ignoreList="ctrl.ignoreWords" padding="5"
  *     rotate="ctrl.rotateWord" slope-base="2" slope-factor="30" words="ctrl.words">
  *   &lt;/d3-cloud>
  */
/* global d3 */
(function() {
  'use strict';
  angular.module('d3.cloud')
    .directive('d3Cloud', d3CloudDirective);
  d3CloudDirective.$inject = [];
  function d3CloudDirective() {
    return {
      restrict: 'E',
      replace: 'true',
      scope: {
        events: '=?',
        font: '@',
        ignoreList: '=?',
        padding: '@',
        rotate: '&?',
        slopeBase: '@',
        slopeFactor: '@',
        words: '='
      },
      templateUrl: function() { return '/d3-cloud-ng/d3-cloud.html'; },
      controller: 'd3CloudController',
      controllerAs: 'ctrl',
      link: function($scope, $element, $attrs) {
        $scope.events = $scope.events || {};
        $scope.font = $scope.font || 'Impact';
        $scope.ignoreList = $scope.ignoreList || [];
        var padding = $attrs.padding ? Number($scope.padding) : 5;
        var rotate = $scope.rotate && function(d, i) {
          return $scope.rotate({word: $scope.words[i] });
        } || function() {
          return ~~(Math.random() * 2) * 90 - 45;
        };
        var slopeBase = $attrs.slopeBase ? Number($scope.slopeBase) : 2;
        var slopeFactor = $attrs.slopeFactor ? Number($scope.slopeFactor) : 30;
        $scope.createCloud = function(words) {
          var cloudWidth = $element[0].clientWidth + 0;
          var cloudHeight = $element[0].clientWidth + 0;
          var minScore = 0;
          var maxScore = 1;
          var slope = 1;
          words.map(function(d) {
            if (minScore > d.score) {
              minScore = d.score;
            }
            if (maxScore &lt; d.score) {
              maxScore = d.score;
            }
          });
          if (maxScore !== minScore) {
            slope = slopeFactor / (maxScore - minScore);
          }
          $scope.cloud = d3.layout.cloud().size([cloudWidth, cloudHeight]);
          $scope.cloud
            .words(words.map(function(d) {
              return {
                text: d.name,
                size: d.score * slope + slopeBase
              };
            }))
            .padding(padding)
            .rotate(rotate)
            .font($scope.font)
            .fontSize(function(d) {
              return d.size;
            })
            .on('end', draw)
            .start();
        };
        $scope.updateCloud = function(words) {
          var cloudWidth = $element[0].clientWidth + 0;
          var cloudHeight = $element[0].clientWidth + 0;
          var minScore = 0;
          var maxScore = 1;
          var slope = 1;
          words.map(function(d) {
            if (minScore > d.score) {
              minScore = d.score;
            }
            if (maxScore &lt; d.score) {
              maxScore = d.score;
            }
          });
          if (maxScore !== minScore) {
            slope = slopeFactor / (maxScore - minScore);
          }
          $scope.cloud = d3.layout.cloud().size([cloudWidth, cloudHeight]);
          $scope.cloud
            .words(words.map(function(d) {
              return {
                text: d.name,
                size: d.score * slope + slopeBase
              };
            }))
            .padding(padding)
            .rotate(rotate)
            .font($scope.font)
            .fontSize(function(d) {
              return d.size;
            })
            .on('end', update)
            .start();
        };
        if (!$scope.cloud && $scope.words && $scope.words.length) {
          $scope.createCloud($scope.words);
        }
        function update(data) {
          var size = $scope.cloud.size();
          var fill = (d3.schemeCategory20 ? d3.schemeCategory20() : d3.scale.category20());
          var words = d3.select($element[0]).select('svg')
            .selectAll('g')
            .attr('transform', 'translate('+size[0]/2+','+size[1]/2+')')
            .selectAll('text')
            .data(data);
          // append new text elements
          words.enter().append('text');
          // update all words in the word cloud (when you append
          // nodes from the 'enter' selection, d3 will add the new
          // nodes to the 'update' selection, thus all of them will
          // be updated here.
          words.style('font-size', function(d) {
              return d.size + 'px';
            })
            .style('font-family', $scope.font)
            .style('fill', function(d, i) {
              return fill(i);
            })
            .attr('text-anchor', 'middle')
            .attr('transform', function(d) {
              return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
            })
            .on($scope.events)
            .text(function(d) {
              return d.text;
            });
          words.exit().remove(); // new line to remove all unused words
        }
        function draw(words) {
          var size = $scope.cloud.size();
          var fill = (d3.schemeCategory20 ? d3.schemeCategory20() : d3.scale.category20());
          d3.select($element[0]).append('svg')
            .attr('width', size[0])
            .attr('height', size[1])
            .append('g')
            .attr('transform', 'translate('+size[0]/2+','+size[1]/2+')')
            .selectAll('text')
            .data(words)
            .enter().append('text')
            .style('font-size', function(d) {
              return d.size + 'px';
            })
            .style('font-family', $scope.font)
            .style('fill', function(d, i) {
              return fill(i);
            })
            .attr('text-anchor', 'middle')
            .attr('transform', function(d) {
              return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
            })
            .on($scope.events)
            .text(function(d) {
              return d.text;
            });
        }
      }
    };
  }
}());
</code></pre>
        </article>
        <!-- index.html -->
        <!-- class files -->
      </div>
      <footer style="clear:both">
        Documentation generated by
        <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a>
        using
        <a href="https://github.com/allenhwkim/angular-jsdoc">Angular-JSDoc template</a>
      </footer>
    </div>
    <script src="js/prettify.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/site.js"></script>
    <!--%= prettyJson %-->
    <script>
      prettyPrint();
      var lineNo = window.location.hash.match(/#line([0-9]+)$/);
      lineNo && document.querySelector("ol li:nth-child("+(lineNo[1])+")").scrollIntoView();
    </script>
  </body>
</html>